<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <title>Live game</title>
  </head>
  <body>
    <nav>
      <ul class="nav-menu">
        <li><a href="index.html">Summoner Search</a></li>
        <li><a href="livegame.html">Live game</a></li>
      </ul>
    </nav>
    <div>
      <input id="game-search" type="text" placeholder="search game" />
      <button id="searchGame-button" onclick="searchGame()">Search</button>
    </div>
    <div><h1 id="gameName"></h1></div>
    <p><span id="game-mode"></span></p>
    <div id="blue-team"></div>
    <div id="red-team"></div>
    <table id="team-table"></table>

    <script>
      const api_key = "RGAPI-3ea11175-ea19-416a-ae72-75611ecf2054";
      const region = "euw1";
      function searchGame() {
        let gameName = document.getElementById("game-search");
        let name = gameName.value;
        let gameId;
        let gameData;
        let gameMode;
        let redTeam = [];
        let blueTeam = [];
        fetch(
          `https://${region}.api.riotgames.com/lol/summoner/v4/summoners/by-name/${name}?api_key=${api_key}`
        )
          .then((response) => response.json())
          .then((data) => {
            gameId = data.id;
            let summonerGameElement = document.querySelector("h1");
            summonerGameElement.innerText = data.name + "'s" + " Live game";

            return fetch(
              ` https://${region}.api.riotgames.com/lol/spectator/v4/active-games/by-summoner/${gameId}?api_key=${api_key}`
            );
          })
          .then((response) => response.json())
          .then((data) => {
            gameData = data;
            console.log(gameData);
            console.log(gameData.mapId);
            gameMode = gameData.gameQueueConfigId;
            if (gameMode === 420) {
              let gameModeElement = document.getElementById("game-mode");
              gameModeElement.innerText = "Ranked Solo/Duo";
            } else if (gameMode === 440) {
              let gameModeElement = document.getElementById("game-mode");
              gameModeElement.innerText = "Ranked Flex";
            } else if (gameMode === 450) {
              let gameModeElement = document.getElementById("game-mode");
              gameModeElement.innerText = "ARAM";
            } else if (gameMode === 400) {
              let gameModeElement = document.getElementById("game-mode");
              gameModeElement.innerText = "Normal Draft";
            } else {
              let gameModeElement = document.getElementById("game-mode");
              gameModeElement.innerText = "Unknown Game mode";
            }

            Promise.all(
              gameData.participants.map((participant) => {
                const { summonerId } = participant;
                return fetch(
                  `https://${region}.api.riotgames.com/lol/league/v4/entries/by-summoner/${summonerId}?api_key=${api_key}`
                ).then((response) => response.json());
              })
            ).then((rankData) => {
              // Once all the fetch requests have completed, loop through the participants again and push them to the correct team array
              gameData.participants.forEach((participant, index) => {
                const { teamId, summonerName } = participant;
                const rank =
                  rankData[index][0].tier + " " + rankData[index][0].rank;
                const player = { name: summonerName, rank: rank };
                if (teamId === 100) {
                  blueTeam.push(player);
                } else {
                  redTeam.push(player);
                }
              });

              console.log(blueTeam);
              console.log(redTeam);
              console.log(gameData.participants[0]);

              let blueTeamList = document.createElement("ul"); // TEHÄÄN itse ul elementti
              blueTeam.forEach((player) => {
                // sit olemassa oleva bluetiimi array käydään läpi (pelaaja kerrallaa)
                let playerListItem = document.createElement("li"); // luodaan lista elementti
                playerListItem.innerText = `${player.name}`; // annetaan jokaiselle lista elementille muoto pelaajannimi - champ
                blueTeamList.appendChild(playerListItem); // lisätää lista elementti ul elementtiin HOX tää siis tehään foreach functiossa eli jokaiselle pelaajalle loopissa
              });
              let blueTeamElement = document.getElementById("blue-team");
              blueTeamElement.appendChild(blueTeamList); // lisätään luotu ul lista html elementtiin

              let redTeamList = document.createElement("ul");
              redTeam.forEach((player) => {
                let playerListItem = document.createElement("li");
                playerListItem.innerText = `${player.name}`;
                redTeamList.appendChild(playerListItem);
              });
              let redTeamElement = document.getElementById("red-team");
              redTeamElement.appendChild(redTeamList);

              // Get a reference to the table element
              let table = document.getElementById("team-table");

              // Create a header row
              let headerRow = document.createElement("tr");

              // Create header cells for the two teams
              let blueTeamHeader = document.createElement("th");
              blueTeamHeader.innerText = "Blue Team";
              blueTeamHeader.classList.add("blue");
              headerRow.appendChild(blueTeamHeader);

              let redTeamHeader = document.createElement("th");
              redTeamHeader.innerText = "Red Team";
              redTeamHeader.classList.add("red");
              headerRow.appendChild(redTeamHeader);

              // Add the header row to the table
              table.appendChild(headerRow);

              // Loop through the players in both teams
              for (
                let i = 0;
                i < Math.max(blueTeam.length, redTeam.length);
                i++
              ) {
                // Create a new row
                let row = document.createElement("tr");

                // Create cells for the players in the blue team
                let blueTeamCell = document.createElement("td");
                if (blueTeam[i]) {
                  let playerInfo = document.createElement("div");
                  playerInfo.innerText = `${blueTeam[i].name} (${blueTeam[i].rank})`;
                  blueTeamCell.appendChild(playerInfo);
                }
                row.appendChild(blueTeamCell);

                // Create cells for the players in the red team
                let redTeamCell = document.createElement("td");
                if (redTeam[i]) {
                  let playerInfo = document.createElement("div");
                  playerInfo.innerText = `${redTeam[i].name} (${redTeam[i].rank})`;
                  redTeamCell.appendChild(playerInfo);
                }
                row.appendChild(redTeamCell);

                // Add the row to the table
                table.appendChild(row);
              }
            });
          });
      } // ens kerralla muuta laita nimet hienosti esille ja koristele
    </script>
  </body>
</html>
